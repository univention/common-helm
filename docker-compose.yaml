---

# SPDX-FileCopyrightText: 2024 Univention GmbH
# SPDX-License-Identifier: AGPL-3.0-only

services:

  test:
    working_dir: "/app/"
    build:
      context: ./
    profiles:
      - test
    volumes:
      - "./helm/:/app/helm/"
      - "./tests/:/app/tests/"

  # Environment to build the documentation
  docs:
    image: docker-registry.knut.univention.de/sphinx:latest@sha256:bd2b67f65aec9681e583379363a9ffb34037e636e79dcf62f5353c4769f228ed
    working_dir: /src/docs
    volumes:
      - ".:/src"
    profiles:
      - docs

  # Environment of the pre-commit linter.
  pre-commit:
    profiles:
      - test
    image: gitregistry.knut.univention.de/univention/customers/dataport/upx/container-pre-commit/upx-pre-commit:latest@sha256:c928a775fdbbb6291311b307952e750f06b1931c65f516e999464fbf0e9a1970
    volumes:
      - type: bind
        source: .
        target: /code
      - type: volume
        # pre-commit installs dependencies, having them cached speeds things up
        # a lot.
        source: pre-commit-cache
        target: /cache

volumes:
  pre-commit-cache:

...
